<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <title>Netty.news: WebSocket Enhancement</title>
    <title>Netty: WebSocket Enhancement</title>
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />
    <link href='../../../../images/favicon.ico' rel='shortcut icon' />
    <link href='http://feeds.feedburner.com/netty_project' rel='alternate' title='News Feed' type='application/rss+xml' />
    <style type='text/css'>
      /*<![CDATA[*/
        body {
          padding-top: 60px;
        }
      /*]]>*/
    </style>
    <link href='http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.no-icons.min.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.0.2/css/font-awesome.min.css' media='screen' rel='stylesheet' type='text/css' />
    <script src='../../../../lib/sh/scripts/shCore.js' type='text/javascript'></script>
    <script src='../../../../lib/sh/scripts/shBrushXml.js' type='text/javascript'></script>
    <link href='../../../../lib/sh/styles/shCore.css' rel='stylesheet' type='text/css' />
    <link href='../../../../lib/sh/styles/shThemeDefault.css' rel='stylesheet' type='text/css' />
    <link href='../../../../lib/common.css' rel='stylesheet' type='text/css' />
    <script src='../../../../lib/common.js' type='text/javascript'></script>
    <!--[if lt IE 9]>
      <script src='http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.1/html5shiv.js' type='text/javascript'></script>
    <![endif]-->
  </head>
  <body>
    <div class='navbar navbar-fixed-top'>
      <div class='navbar-inner'>
        <div class='container'>
          <a class='brand' href='../../../../index.html'>Netty project</a>
          <ul class='nav'>
            <li class='dropdown'>
              <a href='../../../../news/2013/02/26/4-0-0-beta2.html'>
                News
              </a>
              <ul class='dropdown-menu'>
                <li>
                  <a href='../../../../news/index.html'>
                    <i class='icon-briefcase'></i>
                    Archive
                  </a>
                </li>
              </ul>
            </li>
            <li class='dropdown'>
              <a href='../../../../downloads.html'>
                Downloads
              </a>
              <ul class='dropdown-menu'>
                <li>
                  <a href='http://netty.googlecode.com/files/netty-4.0.0.Beta2.tar.bz2'>
                    <i class='icon-download'></i>
                    4.0.0.Beta2
                    <small>&dash; 26-Feb-2013</small>
                  </a>
                </li>
                <li>
                  <a href='http://netty.googlecode.com/files/netty-3.6.3.Final-dist.tar.bz2'>
                    <i class='icon-download'></i>
                    3.6.3.Final
                    <small>&dash; 21-Feb-2013</small>
                  </a>
                </li>
                <li>
                  <a href='http://www.tldrlegal.com/l/APACHE2'>
                    <i class='icon-legal'></i>
                    Apache License 2.0
                  </a>
                </li>
                <li>
                  <a href='http://code.google.com/p/netty/downloads/list'>
                    <i class='icon-briefcase'></i>
                    Previous Releases
                  </a>
                </li>
                <li>
                  <a href='https://netty.ci.cloudbees.com/'>
                    <i class='icon-beaker'></i>
                    Nightly Builds
                  </a>
                </li>
              </ul>
            </li>
            <li class='dropdown'>
              <a href='../../../../wiki/index.html'>
                Documentation
              </a>
              <ul class='dropdown-menu'>
                <li>
                  <a href='../../../../wiki/all-documents.html'>
                    <i class='icon-list'></i>
                    All Documents
                  </a>
                </li>
                <li>
                  <a href='../../../../wiki/related-articles.html'>
                    <i class='icon-bookmark'></i>
                    Related Articles
                  </a>
                </li>
                <li>
                  <a href='../../../../wiki/related-projects.html'>
                    <i class='icon-bookmark'></i>
                    Related Projects
                  </a>
                </li>
              </ul>
            </li>
            <li class='dropdown'>
              <a href='../../../../community.html'>
                Get Involved
              </a>
              <ul class='dropdown-menu'>
                <li>
                  <a href='https://github.com/netty/netty'>
                    <i class='icon-github'></i>
                    Github
                  </a>
                </li>
                <li>
                  <a href='http://stackoverflow.com/questions/tagged/netty'>
                    <i class='icon-question-sign'></i>
                    StackOverflow
                  </a>
                </li>
                <li>
                  <a href='https://twitter.com/netty_project'>
                    <i class='icon-twitter-sign'></i>
                    @netty_project
                  </a>
                </li>
                <li>
                  <a href='../../../../wiki/developer-guide.html'>
                    <i class='icon-cogs'></i>
                    Developer Guide
                  </a>
                </li>
              </ul>
            </li>
            <li>
              <a href='http://feeds.feedburner.com/netty_project'>
                <i class='icon-rss'></i>
              </a>
            </li>
          </ul>
          <form action='../../../../search.html' class='navbar-search pull-right' method='GET' onsubmit='return validateGlobalSearchQuery()'>
            <input class='search-query' id='global-search-query' name='q' placeholder='Search' type='text' />
          </form>
        </div>
      </div>
    </div>
    <div class='container'>
      <div class='content instapaper_body'>
        <div class='news-item'>
  <h1>
    WebSocket Enhancement
  </h1>
  <p class='byline'>
    <small>
      by
      <a href='https://github.com/danbev'>danbev</a>
      <br />
      on
      <time datetime='2012-11-15'>15-Nov-2012</time>
    </small>
  </p>
  <div class='news-content'>
    <h1></h1><div class="entry-content">
<div><p>Netty has had WebSocket support for quite a while now, and it is easy to get up an running quickly with the existing examples. The <span class="wikiexternallink"><a title="Original WebSocket Example" href="https://github.com/netty/netty/blob/master/example/src/main/java/io/netty/example/http/websocketx/server/WebSocketServerHandler.java">example</a></span> provided with Netty, consists of a handler which takes care of the HTTP Upgrade handshake, and also manages the WebSocket protocol. If you need to service http requests, for example serving static files, in addition to WebSocket calls then this approach works great.  </p></div>
<div></div>
<div><p>But if all you want to do is create a custom application protocol on top of WebSocket and only service WebSocket requests, then the above solution is a fair amount of code that you'll have to maintain yourself. So, we set out to try to simplify this and this post describes what we came up with.</p></div>
<div><h3 id="HHandlingaTextSocketFrame"><span>Handling a TextSocketFrame</span></h3></div>
<div><p>Below is an example of implementing a handler that will receive a <span class="wikiexternallink"><a href="https://github.com/netty/netty/blob/master/codec-http/src/main/java/io/netty/handler/codec/http/websocketx/TextWebSocketFrame.java">TextWebSocketFrame</a></span> :</p></div>
<div><script src="https://gist.github.com/4076875.js"></script></div>
<div><p>The text content is retrieved by calling <em>getText,</em> and can then be parsed as required by the application protocol. This might involve parsing the String as JSON or whatever the protocol in question dictates. </p></div>
<div>
<div><h3 id="HBootstrappingNetty"><span><span>Bootstrapping Netty</span></span></h3></div>
<div></div>
</div>
<div><p>Now, lets take a look at what is needed to bootstrap Netty:</p></div>
<div><script src="https://gist.github.com/4076911.js"></script></div>
<div>
<p>As you can see the <em>CustomTextFrameHandler</em> from the previous code example is the last handler added, and right before it, we have a new handler named <span class="wikiexternallink"><a href="https://github.com/netty/netty/blob/master/codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandler.java">WebSocketServerProtocolHandler</a></span>.</p>
<p>An <span class="wikiexternallink"><a title="WebSocket HTML5 example" href="https://github.com/netty/netty/tree/master/example/src/main/java/io/netty/example/http/websocketx/html5">example</a></span> has been included in Netty which uses the above code for the server side, and a simple html page as the WebSocket client.</p>
</div>
<div><h3 id="HNetty3.xSupport"><span>Netty 3.x Support</span></h3></div>
<div><p>This feature has also been back-ported to Netty 3.x. The <em>CustomTextFrameHandler</em> class would then look something like this:</p></div>
<div><script src="https://gist.github.com/4076940.js"></script></div>
<div><p><span>An <span class="wikiexternallink"><a title="WebSocket Example for 3.x" href="https://github.com/netty/netty/tree/3/src/main/java/org/jboss/netty/example/http/websocketx/html5">example</a></span> has been included in Netty which uses the above code for the server side, and a simple html page as the WebSocket client.</span></p></div>
</div>
  </div>
  <ul class='pager'>
    <li class='previous'>
      <a href='../../../../news/2012/11/12/3-6-0-beta1.html'>&larr; Older</a>
    </li>
    <li>
      <a href='../../../index.html'>List all news items</a>
    </li>
    <li class='next'>
      <a href='../../../../news/2012/11/29/3-5-11-final.html'>Newer &rarr;</a>
    </li>
  </ul>
</div>
<div class='comments'>
  
              <div id="disqus_thread"></div>
              <script type="text/javascript">
              var disqus_shortname = 'netty0';
              var disqus_url = "http://netty.io/news/2012/11/15/websocket-enhancement.html";
              var disqus_developer = null;
              var disqus_identifier = "3060860479470210279";
              (function() {
                var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                dsq.src = "http://netty0.disqus.com/embed.js";
                (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
              })();
              </script>
              <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=netty0">comments powered by Disqus.</a></noscript>
</div>
      </div>
      <hr />
      <footer>
        <p>
          Copyright &copy; 2013
          <a href='../../../../index.html'>The Netty project</a>
        </p>
      </footer>
    </div>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js' type='text/javascript'></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.0/js/bootstrap.min.js' type='text/javascript'></script>
    <script src='../../../../lib/common.footer.js' type='text/javascript'></script>
  
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker('UA-95307-5');
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
